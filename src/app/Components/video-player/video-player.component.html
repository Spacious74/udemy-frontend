<p-toast></p-toast>
<div class="container flex">
    <div class="videoPlayer px-3" style="width: 70%;">

        <div class="video_and_title mt-3">
            <div class="video flex align-items-center justify-content-center focus:outline-none" style="width: 100%;">
                <button *ngIf="currentWatchingVideo?.globalVideoIdx != 0" (click)="fetchPreviousVideo()"
                    class="prev vid-btn" pTooltip="Previous Lecture" tooltipPosition="right">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24">
                        <path fill="currentColor"
                            d="m8.5 12.8l5.7 5.6c.4.4 1 .4 1.4 0s.4-1 0-1.4l-4.9-5l4.9-5c.4-.4.4-1 0-1.4c-.2-.2-.4-.3-.7-.3s-.5.1-.7.3l-5.7 5.6c-.4.5-.4 1.1 0 1.6q0-.15 0 0" />
                    </svg>
                </button>
                <button *ngIf="currentWatchingVideo?.globalVideoIdx != selectedCourse?.totalLectures-1"
                    (click)="fetchNextVideo()" class="next vid-btn" pTooltip="Next Lecture" tooltipPosition="left">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24">
                        <path fill="currentColor"
                            d="M15.54 11.29L9.88 5.64a1 1 0 0 0-1.42 0a1 1 0 0 0 0 1.41l4.95 5L8.46 17a1 1 0 0 0 0 1.41a1 1 0 0 0 .71.3a1 1 0 0 0 .71-.3l5.66-5.65a1 1 0 0 0 0-1.47" />
                    </svg>
                </button>
                <video #videoPlayer height="420" class="w-full" [src]="currentUrl" controls disablePictureInPicture
                    controlsList="nodownload noplaybackrate" oncontextmenu="return false;"
                    (ended)="onVideoEnded()"></video>
            </div>
            <div class="video_title font-bold flex justify-content-between gap-2">
                <span>Lecture {{currentWatchingVideo?.globalVideoIdx+1}}. {{currentWatchingVideo?.videoTitle}}</span>
                <p-tag [value]="'Section '+currentSectionIndex" [rounded]="true" />
            </div>
        </div>

        <div class="rest">
            <p-tabView [activeIndex]="0">
                <p-tabPanel>
                    <ng-template pTemplate="header">
                        <span class="flex gap-2 align-items-center "> <i class="pi pi-book"></i> Overview</span>
                    </ng-template>

                    <!-- OVERVIEW COMPONENT -->
                    <app-overview [course]="selectedCourse"></app-overview>

                </p-tabPanel>
                <p-tabPanel>
                    <ng-template pTemplate="header">
                        <span class="flex gap-2 align-items-center "> <i class="pi pi-star"></i> Rate & Reviews</span>
                    </ng-template>

                    <!-- RATE AND REVIEW COMPONENT -->
                    <app-rate-review></app-rate-review>

                </p-tabPanel>
                <p-tabPanel>
                    <ng-template pTemplate="header">
                        <span class="flex gap-2 align-items-center "><i class="pi pi-file"></i> Certificate</span>
                    </ng-template>

                    <!-- CERTIFICATE COMPONENT -->
                    <app-certificate [completionStatus]="completionStatus" (runParent)="generateCertificate($event)"
                        [loading]="certificateLoadingState"></app-certificate>

                </p-tabPanel>
                <p-tabPanel [disabled]="true">
                    <ng-template pTemplate="header">
                        <span class="flex gap-2 align-items-center ">
                            <i class="pi pi-question-circle"></i> Q&A</span>
                    </ng-template>

                    <!-- QUESTION & ANSWER COMPONENT -->
                    <app-que-ans></app-que-ans>

                </p-tabPanel>


            </p-tabView>
        </div>

    </div>
    <div class="playlistcontainer mt-3 surface-0" style="width: 28%;">
        <div class="mb-1 header p-3 border-bottom-2 border-100 flex justify-content-between">
            <span class="font-bold">Course content</span>
            <div>{{totalCompletedLectures}}/{{totalLectures}} Watched</div>
        </div>
        <div class="playlist">
            <p-accordion [activeIndex]="activeIndex" (onOpen)="onAccordionOpen($event)"
                (onClose)="onAccordionClose($event)" [multiple]="true" expandIcon="pi pi-chevron-down"
                collapseIcon="pi pi-chevron-up">

                <p-accordionTab *ngFor="let item of sectionList; index as idx">

                    <ng-template pTemplate="header">
                        <div class="custom-header flex flex-column">
                            <div class="font-bold">Section {{idx+1}}. {{item.sectionName}}</div>
                            <div class="text-xs text-600 font-normal mr-1">{{item.videos.length + ' lectures'}}</div>
                        </div>
                    </ng-template>

                    <ng-container *ngFor="let cont of item.videos; index as vidIdx">
                        <div class="video_text_section flex align-items-start gap-2" (click)="getReqVideo(cont._id)"
                            [ngClass]="{ 'active': currentVideoId === cont._id }">

                            <ng-container *ngIf="videoSet.has(cont._id); else notDone">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 16 16">
                                    <path fill="currentColor"
                                        d="M4.5 2A2.5 2.5 0 0 0 2 4.5v7A2.5 2.5 0 0 0 4.5 14h7a2.5 2.5 0 0 0 2.5-2.5v-7A2.5 2.5 0 0 0 11.5 2zm6.354 4.854l-3.5 3.5a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 9.293l3.146-3.147a.5.5 0 0 1 .708.708" />
                                </svg>
                            </ng-container>

                            <ng-template #notDone>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                        d="M3 6.25A3.25 3.25 0 0 1 6.25 3h11.5A3.25 3.25 0 0 1 21 6.25v11.5A3.25 3.25 0 0 1 17.75 21H6.25A3.25 3.25 0 0 1 3 17.75zM6.25 5C5.56 5 5 5.56 5 6.25v11.5c0 .69.56 1.25 1.25 1.25h11.5c.69 0 1.25-.56 1.25-1.25V6.25C19 5.56 18.44 5 17.75 5z" />
                                </svg>
                            </ng-template>
                            <p class="m-0 text-sm ">
                                <span *ngIf="idx==0">{{ vidIdx + 1 }}. </span>
                                <span *ngIf="idx>0">{{getSequence(idx, vidIdx)}}. </span>
                            </p>
                            <p class="video_text m-0 text-sm ">{{ cont.name }}</p>

                        </div>
                    </ng-container>

                </p-accordionTab>
            </p-accordion>
        </div>
    </div>
</div>